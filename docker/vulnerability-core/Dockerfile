# bbai-vulnerability-core: Vulnerability scanning with Nuclei
# Tools: Nuclei with 800MB+ templates

FROM golang:1.22-alpine AS builder

# Install build dependencies
RUN apk add --no-cache git build-base

# Install Nuclei
RUN go install -v github.com/projectdiscovery/nuclei/v3/cmd/nuclei@latest

# Final stage
FROM alpine:3.19

# Install runtime dependencies
RUN apk add --no-cache ca-certificates bind-tools git

# Copy nuclei binary
COPY --from=builder /go/bin/nuclei /usr/local/bin/

# Create non-root user
RUN adduser -D -u 1000 scanner

# Create workspace and config directories
RUN mkdir -p /workspace /home/scanner/.config/nuclei && \
    chown -R scanner:scanner /workspace /home/scanner

# Switch to non-root for template download
USER scanner

# Update Nuclei templates
RUN nuclei -update-templates

WORKDIR /workspace

# Default command
ENTRYPOINT ["nuclei"]
